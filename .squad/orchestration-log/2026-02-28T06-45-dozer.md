# Orchestration Log: Dozer (DevOps)

**Timestamp:** 2026-02-28T06:45:00Z  
**Agent:** Dozer (DevOps)  
**Task:** Fix 6 Bicep deployment blockers + update CI/CD pipelines  
**Mode:** Background

## Outcome: ✅ COMPLETE

### Summary

Fixed all 6 deployment blockers across 13 files. Bicep templates now compile without errors, hardcoded VNet names are parameterized, Key Vault defaults to deny-by-default security posture, Container Apps subnet has required delegation, password parameters removed from .bicepparam files, and all 10 CI/CD pipelines updated from `iac/` to `infrastructure/` paths.

### Changes Made

**Bicep Templates (3 files):**
- `infrastructure/bicep/agents/main.bicep` — Removed duplicate `githubRunnersSubnet` resource. Added `coreVnetName` parameter.
- `infrastructure/bicep/iaas/main.bicep` — Added `coreVnetName` parameter replacing hardcoded VNet name `jobsite-dev-vnet-ubzfsgu4p5eli`.
- `infrastructure/bicep/core/core-resources.bicep` — Key Vault `networkAcls.defaultAction` changed from `Allow` to `Deny`. Container Apps subnet `snet-ca` now has `Microsoft.App/environments` delegation.

**CI/CD Pipelines (10 files):**
- `.github/workflows/deploy-agents.yml` — Path: `iac/` → `infrastructure/`
- `.github/workflows/deploy-core.yml` — Path: `iac/` → `infrastructure/`
- `.github/workflows/deploy-iaas.yml` — Path: `iac/` → `infrastructure/`
- `.github/workflows/deploy-paas.yml` — Path: `iac/` → `infrastructure/`
- `.github/workflows/deploy-vpn.yml` — Path: `iac/` → `infrastructure/`
- `.azure-pipelines/deploy-agents.yml` — Path: `iac/` → `infrastructure/`
- `.azure-pipelines/deploy-core.yml` — Path: `iac/` → `infrastructure/`
- `.azure-pipelines/deploy-iaas.yml` — Path: `iac/` → `infrastructure/`
- `.azure-pipelines/deploy-paas.yml` — Path: `iac/` → `infrastructure/`
- `.azure-pipelines/deploy-vpn.yml` — Path: `iac/` → `infrastructure/`

### Key Decisions Documented

- **VNet Parameterization:** iaas/agents layers now receive `coreVnetName` from core module output (deployment-time parameter, not hardcoded)
- **Key Vault Security:** All Key Vault instances default to deny-by-default. Access only via private endpoints or Azure services bypass.
- **Container Apps:** Subnet delegation ensures Container Apps Environment deployments will succeed.
- **Sensitive Params:** .bicepparam files gitignored (passwords never in repo). Must pass via CLI or Key Vault reference.

### Team Impact

- Infrastructure deployment commands are now executable
- Bicep compilation errors eliminated
- All pipelines will trigger on correct path changes
- Subsequent layers (iaas, agents) require passing core VNet name parameter

### Related Artifacts

- Decision merged: `.squad/decisions.md` — "2026-02-28: Deployment Blocker Fixes" (added to Tank's cross-context)
- Inbox decision: `.squad/decisions/inbox/dozer-deployment-blocker-fixes.md` (merged to decisions.md)

### Status

**✅ COMPLETE** — All 6 blockers fixed. Ready for Phase 1 infrastructure validation and Tank's runtime testing.
